Service:
  RegionId: cn-hangzhou
  DeployType: ros
  OperationMetadata:
    StatusOperationConfigs:
    - TemplateName: ECS单机版
      SupportOperations:
      - Start
      - Stop
      - Restart
    SupportBackup: true
    ModifyParametersConfig:
    - TemplateName: ECS单机版
      Operation:
      - Name: 变更ECS实例规格
        Description: 变更ECS实例规格
        Type: Custom
        Parameters:
        - EcsInstanceType
      - Name: 变更ECS实例密码
        Description: 变更ECS实例密码
        Type: Custom
        Parameters:
        - InstancePassword
  UpgradeMetadata:
    Description: 升级
    SupportUpgradeFromVersions: []
    SupportRollback: true
    UpgradeComponents:
    - Configuration
    - Resource
  DeployMetadata:
    SupplierDeployMetadata:
      SupplierTemplateConfigs:
      - Name: ECS单机版
        Url: 'ros_templates/template.yaml'
        ArchitectureDiagramUrl: 'resources/architecture/architecture.jpg'
      ArtifactRelation:
        ecs_image_quickstart-langsmith:
          ArtifactId: ${Artifact.EcsImage.ArtifactId}
          ArtifactVersion: draft
    TemplateConfigs:
    - Name: ECS单机版
      Url: 'ros_templates/template.yaml'
      ArchitectureDiagramUrl: 'resources/architecture/architecture.jpg'
  ServiceType: private
  ServiceInfo:
  - Locale: zh-CN
    Name: LangSmith社区版
    ShortDescription: LangSmith 提供用于开发、调试和部署 LLM 应用程序的工具。它能帮助您在一个平台上跟踪请求、评估输出、测试提示并管理部署。LangSmith 与框架无关，因此您可以将其与 LangChain 的开源库 langchain 和 langgraph 一起使用，也可以单独使用。先在本地进行原型设计，然后利用集成的监控和评估功能将其部署到生产环境，从而构建更可靠的 AI 系统。
    Image: resources/icons/service_logo.jpg
    Softwares: []
Artifact:
  EcsImage:
    ArtifactType: EcsImage
    ArtifactName: ecs_image_quickstart-langsmith
    Description: quickstart-langsmith EcsImage
    ArtifactProperty:
      RegionId: ${ImageBuilder.EcsImage.RegionId}
      ImageId: ${ImageBuilder.EcsImage.SourceImageId}
ImageBuilder:
  EcsImage:
        RegionId: ap-southeast-1
        SourceImageId: aliyun_3_x64_20G_alibase_20240819.vhd
        SystemDiskSize: 20
        InstanceType: ecs.c6.large
        InternetMaxBandwidthOut: 10
        CommandType: RunShellScript
        Timeout: 10800
        Tags: [ ]
        CommandContent: |-
          #!/bin/bash
          # 升级基础组件：
          yum check-update
          yum -y upgrade --security
          yum -y upgrade-minimal

          # 安装docker-ce
          yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
          yum makecache
          yum install -y curl git docker-ce
          mkdir -p /etc/docker/
          echo '{
              "default-address-pools": [
                  {
                      "base": "10.255.0.0/16",
                      "size": 24
                  }
              ]
          }' > /etc/docker/daemon.json

          prefixChinaRegion="cn-"
          region=$(curl -s http://100.100.100.200/latest/meta-data/region-id)

          if [[ ${region} == ${prefixChinaRegion}* && ${region} != "cn-hongkong" ]]; then
            echo '{
                "default-address-pools": [
                    {
                        "base": "10.255.0.0/16",
                        "size": 24
                    }
                ],
                "registry-mirrors": [
                    "https://mirrors-ssl.aliyuncs.com/"
                ]
            }' > /etc/docker/daemon.json
          fi

          sudo systemctl enable --now docker.socket
          sudo systemctl enable --now docker.service

          cd /root
          git clone https://github.com/langchain-ai/helm.git
          cd /root/helm/charts/langsmith/docker-compose
          cp .env.example .env
          docker compose up -d
